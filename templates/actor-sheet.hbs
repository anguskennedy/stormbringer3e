<link rel="stylesheet" href="systems/stormbringer3e/css/stormbringer.css">
<link href="https://fonts.googleapis.com/css2?family=Special+Elite&display=swap" rel="stylesheet">

<form class="stormbringer-sheet" autocomplete="off">

  <!-- HEADER -->
  <header class="stormbringer-header">
    <div class="title">Stormbringer Character Description Form</div>
    <div class="small center">
      <div>Fantasy Roleplaying in the World of Elric</div>
    </div>
  </header>

  <!-- CHARACTER INFO -->
  <section class="stormbringer-section char-info">
    <div class="char-info-row">
      <label>Name:</label>
      <input type="text" name="name" value="{{actor.name}}" />
      <label>Sex:</label>
      <input type="text" name="system.details.sex" value="{{system.details.sex}}" />
      <label>Age:</label>
      <input type="number" name="system.details.age" value="{{system.details.age}}" />
      <label>Player:</label>
      <input type="text" name="system.details.player" value="{{system.details.player}}" />
    </div>
    <div class="char-info-row">
      <label>Nationality:</label>
      <input type="text" name="system.details.nationality" value="{{system.details.nationality}}" />
      <label>Class:</label>
      <input type="text" name="system.details.class" value="{{system.details.class}}" />
      <label>Cult:</label>
      <input type="text" name="system.details.cult" value="{{system.details.cult}}" />
      <label>Elan:</label>
      <input type="number" name="system.details.elan" value="{{system.details.elan}}" />
    </div>
  </section>

  <section class="stormbringer-section">
    <div class="tabletop">
      <div class="cell attributeCell">
        {{#each system.attributes as |v k|}}
          <div class="attribute-row flexrow">
            <label class="attr-label" data-action="roll-attr" data-attr="{{k}}">{{k}}</label>
            <input type="number" class="attr-value" name="system.attributes.{{k}}" value="{{v}}" />
          </div>
        {{/each}}
      </div>
      <div class="cell descriptionCell">
        <p>DESCRIPTION</p>
        <textarea class="cell-textarea description-text" name="system.narrative.description">{{system.narrative.description}}</textarea>
      </div>
      <div class="cell afflictionsCell">
        <p>AFFLICTIONS</p>
        <textarea class="cell-textarea textarea-plain" name="system.narrative.afflictions">{{system.narrative.afflictions}}</textarea>
      </div>
      <div class="cell armourCell">
        <div class="armor-block">
          <div class="armor-inline">
            <span class="bold armor-title">Armor</span>
            <input type="text" class="armor-input armor-name-input" name="system.armour.name" value="{{system.armour.name}}" placeholder="Plate" />
            <span class="armor-divider">/</span>
            <input type="text" class="armor-input armor-protection-input" name="system.armour.protection" value="{{system.armour.protection}}" placeholder="1d10+2" />
            <button type="button" class="armor-protection-roll" title="Roll Armor Protection">ðŸŽ²</button>
          </div>
          <div class="hp-row">
            <span>Major Wound Level:</span>
            <span class="hp-max">{{system.wounds.major}}</span>
          </div>
          <div class="hp-row">
            <span>Hit Points:</span>
            <input type="number" class="hp-input" name="system.resources.hp.value" value="{{system.resources.hp.value}}" />
            <span class="hp-max">/ {{system.resources.hp.max}}</span>
          </div>
        </div>
      </div>
    </div>
  </section>



  <!-- POSSESSIONS & WEAPONS -->
  <section class="stormbringer-section">
    <div class="tableMiddle">
      <div class="cell possessionsCell">
        <p>POSSESSIONS</p>
        <textarea class="cell-textarea textarea-plain" name="system.narrative.possessions">{{system.narrative.possessions}}</textarea>
      </div>
      <div class="cell weaponsCell" data-drop-target="true">
        <p>WEAPONS</p>
        <div class="weapons-table">
          <div class="weapon-row weapon-header">
            <div class="weapon-cell">Weapon</div>
            <div class="weapon-cell">Attack</div>
            <div class="weapon-cell">Damage</div>
            <div class="weapon-cell">Parry</div>
          </div>

          <div class="weapon-row weapon-bonus-row">
            <div class="weapon-cell weapon-name">Bonuses</div>
            <div class="weapon-cell weapon-value attack">
              <span class="weapon-derived-value">{{system.combat.attackBonus}}</span>
              <span class="item-percent">%</span>
            </div>
            <div class="weapon-cell weapon-value damage">
              <input type="text" name="system.combat.damageMods.hand" value="{{system.combat.damageMods.hand}}" placeholder="+d?" aria-label="Hand damage modifier" />
              <span class="divider">/</span>
              <input type="text" name="system.combat.damageMods.projectile" value="{{system.combat.damageMods.projectile}}" placeholder="+D?" aria-label="Projectile damage modifier" />
            </div>
            <div class="weapon-cell weapon-value parry">
              <span class="weapon-derived-value">{{system.combat.parryBonus}}</span>
              <span class="item-percent">%</span>
            </div>
          </div>

          {{#if weaponRows.length}}
            {{#each weaponRows as |weapon|}}
              <div class="weapon-row" data-item-id="{{weapon.id}}">
                <div class="weapon-cell weapon-name">{{weapon.name}}</div>
                <div class="weapon-cell weapon-value attack">
                  <button type="button" class="weapon-roll" data-action="roll-weapon" data-roll-type="attack" data-weapon-id="{{weapon.id}}" title="Roll Attack">ðŸŽ²</button>
                  <input type="number" class="weapon-stat-input" data-weapon-id="{{weapon.id}}" data-stat="attack" value="{{weapon.attackDisplay}}" />
                  <span class="item-percent">%</span>
                </div>
                <div class="weapon-cell weapon-value damage">
                  {{#if weapon.damageFormula}}
                    <button type="button" class="weapon-damage-roll" data-weapon-id="{{weapon.id}}" data-damage-formula="{{weapon.damageFormula}}" title="Roll Damage">
                      {{weapon.damageDisplay}}
                    </button>
                  {{else}}
                    â€”
                  {{/if}}
                </div>
                <div class="weapon-cell weapon-value parry">
                  {{#if weapon.isProjectile}}
                    â€”
                  {{else}}
                    <button type="button" class="weapon-roll" data-action="roll-weapon" data-roll-type="parry" data-weapon-id="{{weapon.id}}" title="Roll Parry">ðŸŽ²</button>
                    <input type="number" class="weapon-stat-input" data-weapon-id="{{weapon.id}}" data-stat="parry" value="{{weapon.parryDisplay}}" />
                    <span class="item-percent">%</span>
                  {{/if}}
                </div>
              </div>
            {{/each}}
          {{else}}
            <div class="weapon-row weapon-empty">
              <div class="weapon-cell weapon-value">
                <div class="center small">Drag weapon items here to equip them.</div>
              </div>
            </div>
          {{/if}}
        </div>
      </div>
      <div class="cell moneyCell">
        <p>MONEY</p>
        <textarea class="cell-textarea textarea-plain" name="system.narrative.money">{{system.narrative.money}}</textarea>
      </div>
       <div class="cell notesCell">
        <p>NOTES</p>
        <textarea class="cell-textarea textarea-plain" name="system.narrative.notes">{{system.narrative.notes}}</textarea>
      </div>                 
    </div>
  </section>

  <!-- SKILLS -->
  <section class="stormbringer-section">
    <div class="tableSkills">
      <div class="cell agilityCell">
        <div class="skill-header">
          <p>AGILITY</p>
          <div class="skill-bonus">
            <span>bonus</span>
            <span class="skill-bonus-value">{{skillBonuses.agility}}%</span>
          </div>
        </div>
        {{#each skillsByType.agility as |item|}}
          <div class="skill-row flexrow" data-item-id="{{item.id}}" draggable="true">
            <label class="skill-roll" data-action="roll-skill" data-item-id="{{item.id}}">{{item.name}}</label>
            <span class="item-field-wrapper">
              <input type="number" value="{{item.total}}" data-item-id="{{item.id}}" data-field="system.base" data-bonus="{{item.bonus}}" data-base-bonus="{{item.baseBonus}}" class="item-field" />
              <span class="item-percent">%</span>
            </span>
          </div>
        {{/each}}
      </div>
      <div class="cell perceptCell">
        <div class="skill-header">
          <p>PERCEPT</p>
          <div class="skill-bonus">
            <span>bonus</span>
            <span class="skill-bonus-value">{{skillBonuses.percept}}%</span>
          </div>
        </div>
        {{#each skillsByType.percept as |item|}}
          <div class="skill-row flexrow" data-item-id="{{item.id}}" draggable="true">
            <label class="skill-roll" data-action="roll-skill" data-item-id="{{item.id}}">{{item.name}}</label>
            <span class="item-field-wrapper">
              <input type="number" value="{{item.total}}" data-item-id="{{item.id}}" data-field="system.base" data-bonus="{{item.bonus}}" data-base-bonus="{{item.baseBonus}}" class="item-field" />
              <span class="item-percent">%</span>
            </span>
          </div>
        {{/each}}        
      </div>
      <div class="cell stealthCell">
        <div class="skill-header">
          <p>STEALTH</p>
          <div class="skill-bonus">
            <span>bonus</span>
            <span class="skill-bonus-value">{{skillBonuses.stealth}}%</span>
          </div>
        </div>
        {{#each skillsByType.stealth as |item|}}
          <div class="skill-row flexrow" data-item-id="{{item.id}}" draggable="true">
            <label class="skill-roll" data-action="roll-skill" data-item-id="{{item.id}}">{{item.name}}</label>
            <span class="item-field-wrapper">
              <input type="number" value="{{item.total}}" data-item-id="{{item.id}}" data-field="system.base" data-bonus="{{item.bonus}}" data-base-bonus="{{item.baseBonus}}" class="item-field" />
              <span class="item-percent">%</span>
            </span>
          </div>
        {{/each}}        
      </div>
      <div class="cell knowCell">
        <div class="skill-header">
          <p>KNOW</p>
          <div class="skill-bonus">
            <span>bonus</span>
            <span class="skill-bonus-value">{{skillBonuses.know}}%</span>
          </div>
        </div>
        {{#each skillsByType.know as |item|}}
          <div class="skill-row flexrow" data-item-id="{{item.id}}" draggable="true">
            <label class="skill-roll" data-action="roll-skill" data-item-id="{{item.id}}">{{item.name}}</label>
            <span class="item-field-wrapper">
              <input type="number" value="{{item.total}}" data-item-id="{{item.id}}" data-field="system.base" data-bonus="{{item.bonus}}" data-base-bonus="{{item.baseBonus}}" class="item-field" />
              <span class="item-percent">%</span>
            </span>
          </div>
        {{/each}}
<!--
        <div class="craft-skill-block">
          <div class="craft-header">Craft</div>
          {{#each craftSlots as |slot|}}
            <div class="skill-row flexrow craft-slot{{#unless slot.item}} craft-slot-empty{{/unless}}" data-drop-target="true" data-craft-slot="{{slot.index}}" {{#if slot.item}}data-item-id="{{slot.item.id}}" draggable="true"{{/if}}>
              {{#if slot.item}}
                <label class="skill-roll" data-action="roll-skill" data-item-id="{{slot.item.id}}">{{slot.item.name}}</label>
                <span class="item-field-wrapper">
                  <input type="number" value="{{slot.item.total}}" data-item-id="{{slot.item.id}}" data-field="system.base" data-bonus="{{slot.item.bonus}}" data-base-bonus="{{slot.item.baseBonus}}" class="item-field" />
                  <span class="item-percent">%</span>
                </span>
                <button type="button" class="craft-remove" data-craft-slot="{{slot.index}}" title="Remove Craft Skill">âœ•</button>
              {{else}}
                <span class="craft-placeholder">Drop Craft Skill</span>
              {{/if}}
            </div>
          {{/each}}
        </div>
        -->

        {{#if knowLanguages.length}}
          <div class="language-skill-block">
            <div class="language-skill-header">
              <span></span>
              <span>Speak</span>
              <span>R/W</span>
            </div>
            <div class="language-skill-grid">
              {{#each knowLanguages as |lang|}}
                <div class="language-skill-name">
                  <button type="button" class="language-roll" data-language-key="{{lang.key}}">{{lang.name}}</button>
                </div>
                <div class="language-skill-value">
                  {{#if lang.speak}}
                    <span class="item-field-wrapper">
                      <input type="number" value="{{lang.speak.total}}" data-item-id="{{lang.speak.id}}" data-field="system.base" data-bonus="{{lang.speak.bonus}}" data-base-bonus="{{lang.speak.baseBonus}}" class="item-field" />
                      <span class="item-percent">%</span>
                    </span>
                  {{else}}
                    <span class="language-empty">â€”</span>
                  {{/if}}
                </div>
                <div class="language-skill-value">
                  {{#if lang.read}}
                    <span class="item-field-wrapper">
                      <input type="number" value="{{lang.read.total}}" data-item-id="{{lang.read.id}}" data-field="system.base" data-bonus="{{lang.read.bonus}}" data-base-bonus="{{lang.read.baseBonus}}" class="item-field" />
                      <span class="item-percent">%</span>
                    </span>
                  {{else}}
                    <span class="language-empty">â€”</span>
                  {{/if}}
                </div>
              {{/each}}
            </div>
          </div>
        {{/if}}
      </div>
      <div class="cell summoningCell">
        <p>SUMMONINGS</p>
        <div class="summoning-groups">
          {{#each summoningGroups as |group|}}
            <div class="summoning-group">
              <p class="summoning-group-title">{{group.label}}</p>
              {{#each group.skills as |item|}}
                <div class="skill-row flexrow" data-item-id="{{item.id}}" draggable="true">
                  <label class="skill-roll" data-action="roll-skill" data-item-id="{{item.id}}">{{item.name}}</label>
                  <span class="item-field-wrapper">
                    <input type="number" value="{{item.total}}" data-item-id="{{item.id}}" data-field="system.base" data-bonus="{{item.bonus}}" data-base-bonus="{{item.baseBonus}}" class="item-field" />
                    <span class="item-percent">%</span>
                  </span>
                </div>
              {{/each}}
            </div>
          {{/each}}
        </div>
      </div>
      <div class="cell manipCell">
        <div class="skill-header">
          <p>MANIP</p>
          <div class="skill-bonus">
            <span>bonus</span>
            <span class="skill-bonus-value">{{skillBonuses.manip}}%</span>
          </div>
        </div>
        {{#each skillsByType.manip as |item|}}
          <div class="skill-row flexrow" data-item-id="{{item.id}}" draggable="true">
            <label class="skill-roll" data-action="roll-skill" data-item-id="{{item.id}}">{{item.name}}</label>
            <span class="item-field-wrapper">
              <input type="number" value="{{item.total}}" data-item-id="{{item.id}}" data-field="system.base" data-bonus="{{item.bonus}}" data-base-bonus="{{item.baseBonus}}" class="item-field" />
              <span class="item-percent">%</span>
            </span>
          </div>
        {{/each}} 
      </div>
      <div class="cell communCell">
        <div class="skill-header">
          <p>COMMUN</p>
          <div class="skill-bonus">
            <span>bonus</span>
            <span class="skill-bonus-value">{{skillBonuses.commun}}%</span>
          </div>
        </div>
        {{#each skillsByType.commun as |item|}}
          <div class="skill-row flexrow" data-item-id="{{item.id}}" draggable="true">
            <label class="skill-roll" data-action="roll-skill" data-item-id="{{item.id}}">{{item.name}}</label>
            <span class="item-field-wrapper">
              <input type="number" value="{{item.total}}" data-item-id="{{item.id}}" data-field="system.base" data-bonus="{{item.bonus}}" data-base-bonus="{{item.baseBonus}}" class="item-field" />
              <span class="item-percent">%</span>
            </span>
          </div>
        {{/each}} 
      </div>
      <div class="cell skillNotesCell">
        <p>NOTES</p>
        <textarea class="cell-textarea textarea-plain" name="system.narrative.skillNotes">{{system.narrative.skillNotes}}</textarea>
      </div>
    </div>
  </section>




</form>
